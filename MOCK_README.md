# Mock数据功能说明

## 功能概述

当远程车架无法使用时，系统支持从本地数据库 `temp/10-10.db` 的 `test_runs` 表中读取mock数据来替代远程API调用。

## 启用Mock模式
后端运行用这个命令
$env:MOCK_API_MODE = "true"; python start.py


## 数据来源

- **数据库文件**: `temp/10-10.db`
- **表名**: `test_runs`
- **数据列**: `actual_output`
- **映射方式**: 根据 `ResultJudge` 类的 `run_id` 属性读取对应记录

## 数据格式

`actual_output` 列存储的是JSON格式的字符串，包含：
```json
{
  "status": "success",
  "timestamp": 1760072658.8349662,
  "data": [
    {
      "name": "信号名称",
      "uuid": null,
      "value": 数值
    },
    ...
  ]
}
```

## 计数器重置

每次重新启动程序时，如果启用了MOCK模式，系统会自动重置run_id计数器，确保从run_id=1开始读取。这样可以保证每次测试都是一致的起始状态。

## 进度同步

Mock模式会区分两种读取类型：

- **初始信号读取**: 使用固定run_id=1，不递增计数器
- **测试结果读取**: 递增run_id，与实际测试进度同步

这样确保了Mock读取的run_id与数据图表的当前运行进度完全同步。

## 智能数据匹配

Mock模式会根据测试配置中的`expected_results`自动调整返回数据：

- 读取测试配置的预期结果
- 修改Mock数据中的对应信号值以匹配预期
- 确保测试能够通过并正确记录进度

例如，如果测试期望"整车State状态"为11，Mock会自动将数据中的该信号值修改为11。

## Mock覆盖范围

Mock模式会模拟以下所有API调用：

- **读取API (read_api)**: 从本地数据库返回测试结果数据
- **发送API (send_api)**: 模拟发送信号成功
- **复位API (api_reset)**: 模拟复位操作成功
- **映射API (api_get_map)**: 模拟获取映射成功

所有API调用在mock模式下都会返回成功状态，确保测试流程能够正常进行。

## 行为说明

1. **正常读取**: 根据当前 `run_id` 读取对应的 `actual_output` 数据
2. **回退机制**: 如果指定的 `run_id` 不存在，会自动使用 `run_id=1` 的数据
3. **数据保持**: 本地数据池的生成和发送API调用保持不变
4. **前端推进**: 通过返回mock数据，前端测试进度可以正常推进

## 测试验证

数据库包含1010条测试记录（run_id: 1-1010），每条记录都包含完整的测试结果数据。

## 注意事项

- 确保 `temp/10-10.db` 文件存在且包含有效的测试数据
- Mock模式仅影响读取API调用，发送API调用仍然正常工作
- 建议在开发和测试环境中使用此功能